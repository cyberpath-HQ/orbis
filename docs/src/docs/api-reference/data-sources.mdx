---
sidebar_position: 7
title: Data Sources
description: Data loading and management reference
---

import CodeBlock from '@/components/mdx/CodeBlock.astro';


## Data Sources

Reference for loading and managing data in Orbis plugins.

## API Data Sources

### Basic API Call

<CodeBlock lang="json">
```json
{
  "onMount": [
    {
      "type": "callApi",
      "api": "getItems",
      "storeAs": "items"
    }
  ]
}
```
</CodeBlock>

### With Parameters

<CodeBlock lang="json">
```json
{
  "type": "callApi",
  "api": "getItems",
  "params": {
    "page": "{{state.currentPage}}",
    "limit": 20,
    "search": "{{state.searchQuery}}"
  },
  "storeAs": "items"
}
```
</CodeBlock>

### HTTP Methods

<CodeBlock lang="json">
```json
{ "type": "callApi", "api": "getItems", "method": "GET" }
{ "type": "callApi", "api": "createItem", "method": "POST", "params": { "data": "{{form.newItem}}" } }
{ "type": "callApi", "api": "updateItem", "method": "PUT", "params": { "id": "{{state.id}}", "data": "{{form.editItem}}" } }
{ "type": "callApi", "api": "deleteItem", "method": "DELETE", "params": { "id": "{{state.id}}" } }
```
</CodeBlock>

## Response Handling

### Store Full Response

<CodeBlock lang="json">
```json
{
  "type": "callApi",
  "api": "getItems",
  "storeAs": "data"
}
```
</CodeBlock>

Access: `{{state.data}}`

### Extract Response Data

<CodeBlock lang="json">
```json
{
  "type": "callApi",
  "api": "getItems",
  "onSuccess": [
    { "type": "updateState", "path": "items", "value": "{{$response.data}}" },
    { "type": "updateState", "path": "total", "value": "{{$response.total}}" }
  ]
}
```
</CodeBlock>

### Transform Response

<CodeBlock lang="json">
```json
{
  "type": "callApi",
  "api": "getUsers",
  "onSuccess": [
    {
      "type": "updateState",
      "path": "users",
      "value": "{{$response.map(u => ({ ...u, displayName: `${u.firstName} ${u.lastName}` }))}}"
    }
  ]
}
```
</CodeBlock>

## Error Handling

### Basic Error Handling

<CodeBlock lang="json">
```json
{
  "type": "callApi",
  "api": "getData",
  "onError": [
    { "type": "showToast", "message": "Failed to load data", "level": "error" }
  ]
}
```
</CodeBlock>

### Detailed Error Handling

<CodeBlock lang="json">
```json
{
  "type": "callApi",
  "api": "getData",
  "onError": [
    { "type": "updateState", "path": "error", "value": "{{$error}}" },
    { "type": "showToast", "message": "{{$error.message}}", "level": "error" }
  ]
}
```
</CodeBlock>

### Retry Pattern

<CodeBlock lang="json">
```json
{
  "type": "callApi",
  "api": "getData",
  "onError": [
    {
      "type": "conditional",
      "condition": "{{state.retryCount < 3}}",
      "then": [
        { "type": "updateState", "path": "retryCount", "value": "{{state.retryCount + 1}}" },
        { "type": "callApi", "api": "getData" }
      ],
      "else": [
        { "type": "showToast", "message": "Failed after 3 attempts", "level": "error" }
      ]
    }
  ]
}
```
</CodeBlock>

## Loading States

### With Loading Indicator

<CodeBlock lang="json">
```json
{
  "type": "callApi",
  "api": "getData",
  "onStart": [
    { "type": "setLoading", "key": "data", "value": true }
  ],
  "onComplete": [
    { "type": "setLoading", "key": "data", "value": false }
  ]
}
```
</CodeBlock>

### UI with Loading

<CodeBlock lang="json">
```json
{
  "type": "Conditional",
  "conditions": [
    {
      "when": "{{loading.data}}",
      "render": { "type": "Skeleton", "count": 5 }
    }
  ],
  "fallback": {
    "type": "Loop",
    "items": "{{state.items}}",
    "render": { "type": "Card", "children": [] }
  }
}
```
</CodeBlock>

## Pagination

### Page-Based Pagination

<CodeBlock lang="json">
```json
{
  "type": "callApi",
  "api": "getItems",
  "params": {
    "page": "{{state.page}}",
    "limit": "{{state.pageSize}}"
  },
  "onSuccess": [
    { "type": "updateState", "path": "items", "value": "{{$response.data}}" },
    { "type": "updateState", "path": "totalPages", "value": "{{$response.pages}}" }
  ]
}
```
</CodeBlock>

### Cursor-Based Pagination

<CodeBlock lang="json">
```json
{
  "type": "callApi",
  "api": "getItems",
  "params": {
    "cursor": "{{state.cursor}}",
    "limit": 20
  },
  "onSuccess": [
    { "type": "updateState", "path": "items", "value": "{{[...state.items, ...$response.data]}}" },
    { "type": "updateState", "path": "cursor", "value": "{{$response.nextCursor}}" },
    { "type": "updateState", "path": "hasMore", "value": "{{!!$response.nextCursor}}" }
  ]
}
```
</CodeBlock>

### Infinite Scroll

<CodeBlock lang="json">
```json
{
  "type": "Button",
  "text": "Load More",
  "visible": "{{state.hasMore}}",
  "loading": "{{loading.loadMore}}",
  "events": {
    "onClick": [
      { "type": "setLoading", "key": "loadMore", "value": true },
      {
        "type": "callApi",
        "api": "getItems",
        "params": { "cursor": "{{state.cursor}}" },
        "onSuccess": [
          { "type": "updateState", "path": "items", "value": "{{[...state.items, ...$response.data]}}" },
          { "type": "updateState", "path": "cursor", "value": "{{$response.nextCursor}}" }
        ],
        "onComplete": [
          { "type": "setLoading", "key": "loadMore", "value": false }
        ]
      }
    ]
  }
}
```
</CodeBlock>

## Caching Strategies

### Store Response

<CodeBlock lang="json">
```json
{
  "type": "callApi",
  "api": "getConfig",
  "storeAs": "config"
}
```
</CodeBlock>

Data persists in state until page unmount.

### Conditional Fetch

<CodeBlock lang="json">
```json
{
  "onMount": [
    {
      "type": "conditional",
      "condition": "{{!state.dataLoaded}}",
      "then": [
        { "type": "callApi", "api": "getData", "storeAs": "data" },
        { "type": "updateState", "path": "dataLoaded", "value": true }
      ]
    }
  ]
}
```
</CodeBlock>

### Refresh Pattern

<CodeBlock lang="json">
```json
{
  "type": "Button",
  "text": "Refresh",
  "icon": "RefreshCw",
  "events": {
    "onClick": [
      { "type": "setLoading", "key": "refresh", "value": true },
      {
        "type": "callApi",
        "api": "getData",
        "storeAs": "data",
        "onComplete": [
          { "type": "setLoading", "key": "refresh", "value": false }
        ]
      }
    ]
  }
}
```
</CodeBlock>

## Static Data

### Initialize in State

<CodeBlock lang="json">
```json
{
  "initialState": {
    "countries": [
      { "code": "US", "name": "United States" },
      { "code": "CA", "name": "Canada" },
      { "code": "UK", "name": "United Kingdom" }
    ],
    "statusOptions": ["active", "pending", "inactive"]
  }
}
```
</CodeBlock>

### Use in Components

<CodeBlock lang="json">
```json
{
  "type": "Field",
  "fieldType": "select",
  "name": "country",
  "options": "{{state.countries.map(c => ({ value: c.code, label: c.name }))}}"
}
```
</CodeBlock>

## Computed Data

### Derived Values

<CodeBlock lang="json">
```json
{
  "type": "Text",
  "text": "Total: ${{state.items.reduce((sum, i) => sum + i.price, 0).toFixed(2)}}"
}
```
</CodeBlock>

### Filtered Lists

<CodeBlock lang="json">
```json
{
  "type": "Loop",
  "items": "{{state.items.filter(i => i.status === state.filterStatus)}}"
}
```
</CodeBlock>

### Sorted Data

<CodeBlock lang="json">
```json
{
  "type": "Loop",
  "items": "{{state.items.sort((a, b) => state.sortOrder === 'asc' ? a.name.localeCompare(b.name) : b.name.localeCompare(a.name))}}"
}
```
</CodeBlock>

### Grouped Data

<CodeBlock lang="json">
```json
{
  "type": "Text",
  "text": "{{Object.keys(state.items.reduce((groups, item) => ({ ...groups, [item.category]: [...(groups[item.category] || []), item] }), {})).join(', ')}}"
}
```
</CodeBlock>

## Data Relationships

### Master-Detail

<CodeBlock lang="json">
```json
{
  "type": "Flex",
  "children": [
    {
      "type": "List",
      "items": "{{state.categories}}",
      "events": {
        "onSelect": [
          { "type": "updateState", "path": "selectedCategory", "value": "{{$value}}" },
          { "type": "callApi", "api": "getItems", "params": { "category": "{{$value.id}}" } }
        ]
      }
    },
    {
      "type": "Loop",
      "items": "{{state.items}}",
      "render": { "type": "Card", "children": [] }
    }
  ]
}
```
</CodeBlock>

### Dependent Selects

<CodeBlock lang="json">
```json
[
  {
    "type": "Field",
    "fieldType": "select",
    "name": "country",
    "options": "{{state.countries}}",
    "events": {
      "onChange": [
        { "type": "callApi", "api": "getStates", "params": { "country": "{{$value}}" }, "storeAs": "states" },
        { "type": "updateState", "path": "selectedState", "value": null }
      ]
    }
  },
  {
    "type": "Field",
    "fieldType": "select",
    "name": "state",
    "options": "{{state.states}}",
    "disabled": "{{!state.states?.length}}"
  }
]
```
</CodeBlock>

## Best Practices

1. **Show loading states** - Always indicate data fetching
2. **Handle errors gracefully** - Display user-friendly messages
3. **Minimize requests** - Cache when appropriate
4. **Transform at source** - Process data in onSuccess
5. **Use pagination** - Avoid loading large datasets
6. **Clean state on unmount** - Prevent stale data
