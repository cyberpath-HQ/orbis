---
import { docsNav } from '@/lib/navigation';

const currentPath = Astro.url.pathname;

function isActive(href: string | undefined): boolean {
    if (!href) {
        return false;
    }
    return currentPath === href;
}

function isParentActive(items: Array<{ href?: string; items?: Array<{ href?: string }> }>): boolean {
    return items.some((item) => {
        if (item.href && currentPath === item.href) {
            return true;
        }
        if (item.items) {
            return item.items.some((subItem) => subItem.href && currentPath === subItem.href);
        }
        return false;
    });
}
---

<nav class="w-full">
    <div class="space-y-6">
        {docsNav.map((section) => (
            <div class="space-y-3">
                <h4 class="font-semibold tracking-tight text-sm">{section.title}</h4>
                <div class="grid grid-flow-row auto-rows-max text-sm">
                    {section.items.map((item) => (
                        item.items ? (
                            <details class="group" open={isParentActive(item.items)}>
                                <summary class="flex w-full cursor-pointer items-center justify-between rounded-md py-1.5 text-muted-foreground transition-colors hover:text-foreground [&[data-state=open]>svg]:rotate-90">
                                    <span>{item.title}</span>
                                    <svg class="size-4 shrink-0 transition-transform duration-200 group-open:rotate-90" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="m9 18 6-6-6-6" />
                                    </svg>
                                </summary>
                                <div class="mt-1 grid grid-flow-row auto-rows-max pl-4 border-l">
                                    {item.items.map((subItem) => (
                                        <a
                                            href={subItem.href}
                                            class:list={[
                                                `group flex w-full items-center rounded-md py-1.5 transition-colors`,
                                                isActive(subItem.href)
                                                    ? `font-medium text-foreground`
                                                    : `text-muted-foreground hover:text-foreground`,
                                            ]}
                                        >
                                            {subItem.title}
                                        </a>
                                    ))}
                                </div>
                            </details>
                        ) : (
                            <a
                                href={item.href}
                                class:list={[
                                    `group flex w-full items-center rounded-md py-1.5 transition-colors`,
                                    isActive(item.href)
                                        ? `font-medium text-foreground`
                                        : `text-muted-foreground hover:text-foreground`,
                                ]}
                            >
                                {item.title}
                                {item.badge && (
                                    <span class="ml-2 rounded-md bg-primary/10 px-1.5 py-0.5 text-xs font-medium text-primary">
                                        {item.badge}
                                    </span>
                                )}
                            </a>
                        )
                    ))}
                </div>
            </div>
        ))}
    </div>
</nav>
